<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Client Database</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  nav a { margin-right: 15px; cursor: pointer; text-decoration: none; color: blue; }
  nav a.active { font-weight: bold; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  tr.clickable-row { cursor: pointer; }
  form { margin-bottom: 20px; }
  input { padding: 5px; margin-right: 10px; }
  button { padding: 5px 10px; }
</style>
</head>
<body>

<h1>Client Database</h1>

<form id="clientForm">
  <input type="text" id="clientName" placeholder="Client name (optional)" />
  <input type="text" id="whatsappNumber" placeholder="WhatsApp number" required />
  <button type="submit">Add Client</button>
</form>

<nav>
  <a href="#" id="navClients" class="active">Clients</a>
  <a href="#" id="navExpired">Expired</a>
  <a href="#" id="navExpiryComing">Expiry Coming</a>
</nav>

<div id="contentArea">
  <table id="dataTable">
    <thead>
      <!-- Header rows injected dynamically -->
    </thead>
    <tbody>
      <!-- Data rows injected dynamically -->
    </tbody>
  </table>
  <div id="emptyMessage" style="display:none;">No data to show.</div>
</div>


<script>
  // Sample client data (initially will be from backend in real app)
let clients = [
  { id: 1, name: 'Alice', whatsapp: '1234567890' },
  { id: 2, name: 'Bob', whatsapp: '0987654321' }
];

// Sample product data with expiry info
let products = [
  {
    client_id: 1,
    product_link: 'http://example.com/wallart1',
    product_type: 'wall art',
    last_payment_date: '2025-10-01',
    package: 'Month',
    created_date: '2025-09-25',
    expired_date: '2025-10-25'
  },
  {
    client_id: 2,
    product_link: 'http://example.com/sticker1',
    product_type: 'sticker',
    last_payment_date: '2025-11-05',
    package: 'Year',
    created_date: '2025-05-01',
    expired_date: '2026-05-01'
  },
  {
    client_id: 1,
    product_link: 'http://example.com/sticker2',
    product_type: 'sticker',
    last_payment_date: '2025-11-07',
    package: 'free trial',
    created_date: '2025-11-01',
    expired_date: '2025-11-12'
  }
];

const dataTable = document.getElementById('dataTable');
const dataTableHead = dataTable.querySelector('thead');
const dataTableBody = dataTable.querySelector('tbody');
const emptyMessage = document.getElementById('emptyMessage');

// Utility function to parse date strings to Date objects
function parseDate(dateStr) {
  return new Date(dateStr + 'T00:00:00');
}

function renderClients() {
  dataTableHead.innerHTML = '<tr><th>Client ID</th><th>Name</th><th>WhatsApp Number</th></tr>';
  dataTableBody.innerHTML = '';

  if (clients.length === 0) {
    emptyMessage.style.display = 'block';
    emptyMessage.textContent = 'No clients to show.';
    return;
  }
  emptyMessage.style.display = 'none';

  clients.forEach(client => {
    const tr = document.createElement('tr');
    tr.classList.add('clickable-row');
    tr.innerHTML = `
      <td>${client.id}</td>
      <td>${client.name}</td>
      <td>${client.whatsapp}</td>
    `;
    tr.addEventListener('click', () => {
      window.location.href = `client.html?client_id=${client.id}`;
    });
    dataTableBody.appendChild(tr);
  });
}

function renderProducts(productList) {
  dataTableHead.innerHTML = '<tr>' +
    '<th>Client ID</th>' +
    '<th>Product Link</th>' +
    '<th>Product Type</th>' +
    '<th>Last Payment Date</th>' +
    '<th>Package</th>' +
    '<th>Created Date</th>' +
    '<th>Expired Date</th>' +
    '</tr>';
  dataTableBody.innerHTML = '';

  if (productList.length === 0) {
    emptyMessage.style.display = 'block';
    emptyMessage.textContent = 'No data to show.';
    return;
  }
  emptyMessage.style.display = 'none';

  productList.forEach(product => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${product.client_id}</td>
      <td><a href="${product.product_link}" target="_blank">${product.product_link}</a></td>
      <td>${product.product_type}</td>
      <td>${product.last_payment_date}</td>
      <td>${product.package}</td>
      <td>${product.created_date}</td>
      <td>${product.expired_date}</td>
    `;
    dataTableBody.appendChild(tr);
  });
}

function getExpiredProducts() {
  const today = new Date();
  return products.filter(p => parseDate(p.expired_date) < today);
}

function getExpiryComingProducts() {
  const today = new Date();
  return products.filter(p => {
    const expiryDate = parseDate(p.expired_date);
    const diffDays = (expiryDate - today) / (1000 * 3600 * 24);
    return diffDays >= 0 && diffDays <= 3;
  });
}

document.getElementById('clientForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const nameInput = document.getElementById('clientName');
  const whatsapp = document.getElementById('whatsappNumber').value.trim();
  const name = nameInput.value.trim() || 'No Name';

  if (!whatsapp) {
    alert('WhatsApp number is required');
    return;
  }

  // Sending client data without productData (can enhance later)
  fetch('http://localhost:3000/submit', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ clientName: name, whatsappNumber: whatsapp, productData: null }),
  })
  .then(response => response.json())
  .then(data => {
    if (data.error) {
      alert('Error: ' + data.error);
      return;
    }
    alert('Client saved with id ' + data.clientId);
    clients.push({ id: data.clientId, name, whatsapp });
    if (currentTab === 'Clients') {
      renderClients();
    }
    this.reset();
  })
  .catch(err => {
    alert('Submission failed: ' + err.message);
  });
});

let currentTab = 'Clients';

document.getElementById('navClients').addEventListener('click', function(e) {
  e.preventDefault();
  setActiveNav('Clients');
  renderClients();
});

document.getElementById('navExpired').addEventListener('click', function(e) {
  e.preventDefault();
  setActiveNav('Expired');
  renderProducts(getExpiredProducts());
});

document.getElementById('navExpiryComing').addEventListener('click', function(e) {
  e.preventDefault();
  setActiveNav('Expiry Coming');
  renderProducts(getExpiryComingProducts());
});

function setActiveNav(tabName) {
  ['navClients', 'navExpired', 'navExpiryComing'].forEach(id => {
    document.getElementById(id).classList.remove('active');
  });
  if (tabName === 'Clients') {
    document.getElementById('navClients').classList.add('active');
  } else if (tabName === 'Expired') {
    document.getElementById('navExpired').classList.add('active');
  } else if (tabName === 'Expiry Coming') {
    document.getElementById('navExpiryComing').classList.add('active');
  }
  currentTab = tabName;
}

// Initial render of Clients tab
renderClients();

</script>

</body>
</html>
 